<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Assistant</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app" class="glass-container">
    <!-- Draggable Header with Settings Controls -->
    <div class="drag-handle">
      <div class="settings-panel">
        <!-- Content Protection Toggle (Dev Mode Indicator) -->
        <button id="dev-mode-pill" class="dev-mode-pill hidden" title="Click to toggle content protection">
          <span id="dev-pill-text" class="dev-pill-text">DEV</span>
        </button>
        
        <!-- Theme Toggle -->
        <div class="settings-control">
          <span class="settings-label">Theme</span>
          <button id="theme-toggle" class="theme-toggle" title="Toggle Light/Dark Mode">
            <div class="theme-toggle-thumb">
              <svg class="sun-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0-5a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1zm0 18a1 1 0 0 1 1 1v2a1 1 0 1 1-2 0v-2a1 1 0 0 1 1-1z"/>
              </svg>
              <svg class="moon-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
              </svg>
            </div>
          </button>
        </div>

        <!-- Transparency Slider -->
        <div class="settings-control">
          <span class="settings-label">Opacity</span>
          <input type="range" id="transparency-slider" class="transparency-slider" 
                 min="30" max="100" value="100" title="Adjust Window Transparency">
          <span id="transparency-value" class="transparency-value">100%</span>
        </div>
      </div>
    </div>

    <!-- Compact Interface - Horizontal Layout -->
    <div class="main-interface">
      <!-- Status Section with Timer and Count -->
      <div class="status-section">
        <div class="status-dot"></div>
        <span class="timer">00:00</span>
        <div class="screenshot-count" id="screenshot-count">0</div>
      </div>
      
      <!-- Action Buttons - Compact -->
      <div class="content-section">
        <div class="action-buttons">
          <button id="voice-toggle" class="action-btn voice-btn" title="Toggle Voice Recognition (Ctrl+Alt+Shift+V)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
          </button>

          <button id="screenshot-btn" class="action-btn screenshot-btn" title="Screenshot (Ctrl+Alt+Shift+S)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
            </svg>
          </button>

          <button id="analyze-btn" class="action-btn analyze-btn" title="Ask AI (Ctrl+Alt+Shift+A)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z"/>
            </svg>
            <span>Ask AI</span>
          </button>

          <button id="suggest-btn" class="action-btn suggest-btn" title="What should I say?">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 017 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/>
            </svg>
          </button>

          <button id="notes-btn" class="action-btn notes-btn" title="Generate Meeting Notes">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
          </button>

          <button id="insights-btn" class="action-btn insights-btn" title="Get Insights">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
            </svg>
          </button>

          <button id="clear-btn" class="action-btn clear-btn" title="Clear">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
          </button>

          <button id="hide-btn" class="action-btn hide-btn" title="Emergency Hide (Ctrl+Alt+Shift+X)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            </svg>
          </button>

          <button id="settings-btn" class="action-btn settings-btn" title="Settings">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Transcript + Summary Interface -->
    <div id="transcript-container" class="transcript-container">
      <!-- Main Transcript Panel -->
      <div class="transcript-panel">
        <div class="transcript-header">
          <span class="transcript-title"><svg class="section-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg> Transcript</span>
          <div class="transcript-controls">
            <!-- AI Provider Selector -->
            <div class="provider-selector">
              <select id="provider-select" class="provider-select" title="Select AI Provider">
                <option value="gemini">Gemini</option>
                <option value="openai">GPT-4o</option>
                <option value="anthropic">Claude</option>
                <option value="openrouter">OpenRouter</option>
              </select>
            </div>
            <button id="polish-btn" class="copy-btn polish-btn" title="AI Polish Transcript">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.996.996 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96a.996.996 0 000-1.41z"/>
              </svg>
            </button>
            <button id="copy-btn" class="copy-btn" title="Copy Transcript">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
            </button>
          </div>
        </div>
        <div id="transcript-content" class="transcript-content">
          <div class="transcript-empty">
            <span class="transcript-empty-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><path d="M12 19v4"/><path d="M8 23h8"/></svg></span>
            <span>Click the microphone to start recording</span>
          </div>
        </div>
      </div>
      
      <!-- Collapsible Summary Panel -->
      <div id="summary-panel" class="summary-panel">
        <div class="summary-header">
          <div class="summary-header-title">
            <span><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg></span>
            <span>Summary</span>
          </div>
          <div class="summary-actions">
            <button id="refresh-summary" class="icon-btn refresh-btn" title="Refresh summary now">â†»</button>
            <button id="toggle-summary" class="icon-btn chevron-btn" title="Collapse/Expand">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
            </button>
          </div>
        </div>
        <div id="summary-content" class="summary-content">
          <div class="summary-empty">
            <span class="summary-empty-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2zm0-4H7V7h10v2z"/></svg></span>
            <span>Summary will appear here after recording begins</span>
            <span style="font-size: 10px; margin-top: 4px;">Auto-updates every 5 minutes</span>
          </div>
        </div>
        <div id="summary-loading" class="summary-loading hidden">
          <div class="summary-spinner"></div>
          <span class="summary-loading-text">Generating summary...</span>
        </div>
        <div class="summary-footer">
          <span id="summary-timestamp" class="summary-timestamp">Last updated: --</span>
        </div>
      </div>
    </div>
    
    <!-- Legacy Chat Container (hidden, kept for AI responses) -->
    <div id="chat-container" class="chat-container" style="display: none;">
      <div id="chat-messages" class="chat-messages">
        <!-- AI response messages will be added here dynamically -->
      </div>
    </div>
    
    <!-- Hidden status text for feedback -->
    <div id="status-text" class="status-text" style="display: none;">AI Assistant</div>
    
    <!-- Expandable Results Panel (Legacy - now using chat) -->
    <div id="results-panel" class="results-panel hidden">
      <div class="results-header">
        <div class="results-title">
          <span class="ai-response-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg></span>
          <span>AI Response</span>
        </div>
        <div class="results-actions">
          <button id="close-results" class="close-btn" title="Close">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7a1 1 0 1 0-1.42 1.42L10.59 12l-4.9 4.89a1 1 0 0 0 1.42 1.42L12 13.41l4.89 4.9a1 1 0 0 0 1.42-1.42L13.41 12l4.9-4.89a1 1 0 0 0 0-1.4Z"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="results-content">
        <div id="result-text" class="result-text"></div>
      </div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-content">
        <div class="analyzing-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M13 3c.6 0 1.2.4 1.5 1l1.3 3.2c.1.3.4.6.7.7l3.2 1.3c.8.3 1.2 1.3.9 2.1-.1.2-.2.5-.4.7l-2.4 2.4c-.2.2-.4.5-.4.8v3.5c0 .9-.7 1.6-1.6 1.6-.3 0-.5-.1-.8-.2L12 18.5l-3 1.6c-.8.4-1.7.1-2.1-.6-.2-.2-.2-.5-.2-.8v-3.5c0-.3-.1-.6-.4-.8L3.9 12c-.7-.6-.7-1.6-.1-2.2.2-.2.4-.3.7-.4l3.2-1.3c.3-.1.6-.4.7-.7L9.7 4c.3-.6.9-1 1.6-1h1.7zM12 8a4 4 0 1 0 0 8 4 4 0 0 0 0-8z"/></svg></div>
        <div class="loading-text">Analyzing screen...</div>
      </div>
    </div>
    
    <!-- Emergency Overlay -->
    <div id="emergency-overlay" class="emergency-overlay hidden">
      <div class="emergency-message">HIDDEN</div>
    </div>

    <!-- Status Bar Footer -->
    <div id="status-bar" class="status-bar">
      <div class="status-bar-left">
        <span id="status-bar-provider" class="status-bar-item provider-indicator">
          <span class="status-icon">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
          </span>
          <span class="status-label">Gemini</span>
        </span>
        <span id="status-bar-voice" class="status-bar-item voice-indicator">
          <span class="status-icon">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a3 3 0 00-3 3v8a3 3 0 006 0V4a3 3 0 00-3-3z"/><path d="M19 10v2a7 7 0 01-14 0v-2"/><path d="M12 19v4M8 23h8"/></svg>
          </span>
          <span class="status-label">Voice Ready</span>
        </span>
      </div>
      <div class="status-bar-center">
        <div id="status-bar-progress" class="status-bar-progress hidden">
          <div class="mini-progress-bar">
            <div id="mini-progress-fill" class="mini-progress-fill"></div>
          </div>
          <span id="mini-progress-text" class="mini-progress-text">Downloading Vosk...</span>
        </div>
      </div>
      <div class="status-bar-right">
        <span id="ai-activity-indicator" class="status-bar-item ai-activity hidden">
          <span class="ai-spinner"></span>
          <span class="ai-activity-text">AI working...</span>
        </span>
        <span id="status-bar-message" class="status-bar-item status-message"></span>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="settings-modal hidden">
      <div class="settings-modal-content">
        <div class="settings-header">
          <h2 class="settings-title"><svg class="section-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg> Settings</h2>
          <button id="close-settings" class="settings-close-btn" title="Close Settings">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.3 5.71a1 1 0 0 0-1.41 0L12 10.59 7.11 5.7a1 1 0 1 0-1.42 1.42L10.59 12l-4.9 4.89a1 1 0 0 0 1.42 1.42L12 13.41l4.89 4.9a1 1 0 0 0 1.42-1.42L13.41 12l4.9-4.89a1 1 0 0 0 0-1.4Z"/>
            </svg>
          </button>
        </div>

        <div class="settings-body">
          <!-- API Keys Section -->
          <div class="settings-section">
            <div class="section-header">
              <h3 class="section-title"><svg class="section-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg> AI Provider API Keys</h3>
              <p class="section-description">Configure your API keys to enable AI features. Keys are encrypted and stored securely on your device.</p>
            </div>

            <!-- Gemini API Key -->
            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">
                  <span class="provider-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg></span>
                  Google Gemini
                </label>
                <span id="gemini-status" class="api-status"></span>
              </div>
              <p class="field-description">Free tier available. Get your key from <a href="https://aistudio.google.com/" target="_blank">Google AI Studio</a></p>
              <div class="api-key-input-group">
                <input type="password" id="gemini-api-key" class="api-key-input" placeholder="Enter Gemini API key..." autocomplete="off">
                <button class="toggle-visibility-btn" data-target="gemini-api-key" title="Show/Hide">
                  <svg class="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                </button>
                <button class="save-api-key-btn" data-provider="gemini" title="Save Key">Save</button>
                <button class="clear-api-key-btn" data-provider="gemini" title="Clear Key">Clear</button>
              </div>
            </div>

            <!-- OpenAI API Key -->
            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">
                  <span class="provider-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/><circle cx="8" cy="11" r="2"/><circle cx="16" cy="11" r="2"/></svg></span>
                  OpenAI (GPT-4)
                </label>
                <span id="openai-status" class="api-status"></span>
              </div>
              <p class="field-description">Paid API. Get your key from <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI Platform</a></p>
              <div class="api-key-input-group">
                <input type="password" id="openai-api-key" class="api-key-input" placeholder="Enter OpenAI API key (sk-...)..." autocomplete="off">
                <button class="toggle-visibility-btn" data-target="openai-api-key" title="Show/Hide">
                  <svg class="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                </button>
                <button class="save-api-key-btn" data-provider="openai" title="Save Key">Save</button>
                <button class="clear-api-key-btn" data-provider="openai" title="Clear Key">Clear</button>
              </div>
            </div>

            <!-- Anthropic API Key -->
            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">
                  <span class="provider-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-4-8c.79 0 1.5-.71 1.5-1.5S8.79 9 8 9s-1.5.71-1.5 1.5S7.21 12 8 12zm8 0c.79 0 1.5-.71 1.5-1.5S16.79 9 16 9s-1.5.71-1.5 1.5.71 1.5 1.5 1.5zm-4 6c2.21 0 4-1.79 4-4h-8c0 2.21 1.79 4 4 4z"/></svg></span>
                  Anthropic (Claude)
                </label>
                <span id="anthropic-status" class="api-status"></span>
              </div>
              <p class="field-description">Paid API. Get your key from <a href="https://console.anthropic.com/" target="_blank">Anthropic Console</a></p>
              <div class="api-key-input-group">
                <input type="password" id="anthropic-api-key" class="api-key-input" placeholder="Enter Anthropic API key (sk-ant-...)..." autocomplete="off">
                <button class="toggle-visibility-btn" data-target="anthropic-api-key" title="Show/Hide">
                  <svg class="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                </button>
                <button class="save-api-key-btn" data-provider="anthropic" title="Save Key">Save</button>
                <button class="clear-api-key-btn" data-provider="anthropic" title="Clear Key">Clear</button>
              </div>
            </div>

            <!-- OpenRouter API Key -->
            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">
                  <span class="provider-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></span>
                  OpenRouter
                </label>
                <span id="openrouter-status" class="api-status"></span>
              </div>
              <p class="field-description">Access 100+ AI models with one key. Get it from <a href="https://openrouter.ai/keys" target="_blank">OpenRouter</a></p>
              <div class="api-key-input-group">
                <input type="password" id="openrouter-api-key" class="api-key-input" placeholder="Enter OpenRouter API key (sk-or-...)..." autocomplete="off">
                <button class="toggle-visibility-btn" data-target="openrouter-api-key" title="Show/Hide">
                  <svg class="eye-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                  </svg>
                </button>
                <button class="save-api-key-btn" data-provider="openrouter" title="Save Key">Save</button>
                <button class="clear-api-key-btn" data-provider="openrouter" title="Clear Key">Clear</button>
              </div>
            </div>
          </div>

          <!-- AI Settings Section -->
          <div class="settings-section">
            <div class="section-header">
              <h3 class="section-title"><svg class="section-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/><circle cx="8" cy="11" r="2"/><circle cx="16" cy="11" r="2"/></svg> AI Configuration</h3>
              <p class="section-description">Customize AI behavior and default provider settings.</p>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label" for="default-provider">Default AI Provider</label>
              </div>
              <p class="field-description">Select which AI provider to use by default when the app starts.</p>
              <select id="default-provider" class="settings-select">
                <option value="gemini">Google Gemini (Free tier available)</option>
                <option value="openai">OpenAI GPT-4o (Best for code)</option>
                <option value="anthropic">Anthropic Claude (Best for analysis)</option>
                <option value="openrouter">OpenRouter (100+ models)</option>
              </select>
            </div>

            <!-- Model Selection for Each Provider -->
            <div class="settings-field ai-models-config">
              <div class="field-header">
                <label class="field-label">AI Model Selection</label>
              </div>
              <p class="field-description">Choose specific models for each provider. Vision models are used for screenshot analysis, text models for quick responses.</p>
              
              <!-- Gemini Models -->
              <div class="provider-model-group" data-provider="gemini">
                <div class="provider-model-header">
                  <span class="provider-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2z"/></svg></span> Gemini
                </div>
                <div class="model-selectors">
                  <div class="model-selector">
                    <label for="gemini-model">Model</label>
                    <select id="gemini-model" class="model-select">
                      <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite (Fast)</option>
                      <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
                      <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                      <option value="gemini-1.5-pro">Gemini 1.5 Pro (Best)</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- OpenAI Models -->
              <div class="provider-model-group" data-provider="openai">
                <div class="provider-model-header">
                  <span class="provider-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M20 18c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/><circle cx="8" cy="11" r="2"/><circle cx="16" cy="11" r="2"/></svg></span> OpenAI
                </div>
                <div class="model-selectors">
                  <div class="model-selector">
                    <label for="openai-vision-model">Vision Model</label>
                    <select id="openai-vision-model" class="model-select">
                      <option value="gpt-4o">GPT-4o (Best for vision)</option>
                      <option value="gpt-4-turbo">GPT-4 Turbo</option>
                      <option value="gpt-4o-mini">GPT-4o Mini (Fast)</option>
                    </select>
                  </div>
                  <div class="model-selector">
                    <label for="openai-text-model">Text Model</label>
                    <select id="openai-text-model" class="model-select">
                      <option value="gpt-4o-mini">GPT-4o Mini (Fast & Cheap)</option>
                      <option value="gpt-4o">GPT-4o</option>
                      <option value="gpt-4-turbo">GPT-4 Turbo</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Anthropic Models -->
              <div class="provider-model-group" data-provider="anthropic">
                <div class="provider-model-header">
                  <span class="provider-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-4-8c.79 0 1.5-.71 1.5-1.5S8.79 9 8 9s-1.5.71-1.5 1.5S7.21 12 8 12zm8 0c.79 0 1.5-.71 1.5-1.5S16.79 9 16 9s-1.5.71-1.5 1.5.71 1.5 1.5 1.5zm-4 6c2.21 0 4-1.79 4-4h-8c0 2.21 1.79 4 4 4z"/></svg></span> Anthropic
                </div>
                <div class="model-selectors">
                  <div class="model-selector">
                    <label for="anthropic-vision-model">Vision Model</label>
                    <select id="anthropic-vision-model" class="model-select">
                      <option value="claude-sonnet-4-20250514">Claude Sonnet 4 (Latest)</option>
                      <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                      <option value="claude-3-opus-20240229">Claude 3 Opus (Best)</option>
                    </select>
                  </div>
                  <div class="model-selector">
                    <label for="anthropic-text-model">Text Model</label>
                    <select id="anthropic-text-model" class="model-select">
                      <option value="claude-3-haiku-20240307">Claude 3 Haiku (Fast)</option>
                      <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                      <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- OpenRouter Models -->
              <div class="provider-model-group" data-provider="openrouter">
                <div class="provider-model-header">
                  <span class="provider-icon"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg></span> OpenRouter
                </div>
                <div class="model-selectors">
                  <div class="model-selector">
                    <label for="openrouter-vision-model">Vision Model</label>
                    <select id="openrouter-vision-model" class="model-select">
                      <option value="anthropic/claude-3.5-sonnet">Claude 3.5 Sonnet</option>
                      <option value="openai/gpt-4o">GPT-4o</option>
                      <option value="google/gemini-pro-1.5">Gemini Pro 1.5</option>
                      <option value="meta-llama/llama-3.2-90b-vision-instruct">Llama 3.2 Vision</option>
                    </select>
                  </div>
                  <div class="model-selector">
                    <label for="openrouter-text-model">Text Model</label>
                    <select id="openrouter-text-model" class="model-select">
                      <option value="anthropic/claude-3-haiku">Claude 3 Haiku (Fast)</option>
                      <option value="openai/gpt-4o-mini">GPT-4o Mini</option>
                      <option value="google/gemini-flash-1.5">Gemini Flash 1.5</option>
                      <option value="meta-llama/llama-3.1-70b-instruct">Llama 3.1 70B</option>
                      <option value="mistralai/mistral-large">Mistral Large</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">Enable Fallback</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="enable-fallback" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <p class="field-description">If the selected provider fails, automatically try another available provider.</p>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label" for="history-length">Conversation History Length</label>
              </div>
              <p class="field-description">Number of messages to keep in context for AI responses (higher = more context, but slower).</p>
              <div class="range-input-group">
                <input type="range" id="history-length" class="settings-range" min="5" max="50" value="20">
                <span id="history-length-value" class="range-value">20</span>
              </div>
            </div>
          </div>

          <!-- Voice Settings Section -->
          <div class="settings-section">
            <div class="section-header">
              <h3 class="section-title"><svg class="section-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><path d="M12 19v4"/><path d="M8 23h8"/></svg> Voice Recognition</h3>
              <p class="section-description">Configure speech-to-text transcription using Vosk (offline AI).</p>
            </div>

            <!-- Vosk Model Selection -->
            <div class="settings-field vosk-model-field">
              <div class="field-header">
                <label class="field-label">
                  <span class="provider-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></span>
                  Vosk Speech Model
                </label>
                <span id="vosk-status" class="api-status not-configured">Checking...</span>
              </div>
              <p class="field-description">
                Select a Vosk model for offline speech recognition. Larger models are more accurate but slower.
              </p>
              
              <!-- Model Size Selector -->
              <div class="vosk-model-selector">
                <div class="vosk-model-option" data-size="small">
                  <input type="radio" name="vosk-model-size" id="vosk-model-small" value="small">
                  <label for="vosk-model-small">
                    <span class="model-name">Small</span>
                    <span class="model-size">~50 MB</span>
                    <span class="model-desc">Fast, less accurate</span>
                    <span id="vosk-small-status" class="model-install-status"></span>
                  </label>
                </div>
                <div class="vosk-model-option" data-size="medium">
                  <input type="radio" name="vosk-model-size" id="vosk-model-medium" value="medium">
                  <label for="vosk-model-medium">
                    <span class="model-name">Medium</span>
                    <span class="model-size">~500 MB</span>
                    <span class="model-desc">Balanced</span>
                    <span id="vosk-medium-status" class="model-install-status"></span>
                  </label>
                </div>
                <div class="vosk-model-option" data-size="large">
                  <input type="radio" name="vosk-model-size" id="vosk-model-large" value="large" checked>
                  <label for="vosk-model-large">
                    <span class="model-name">Large</span>
                    <span class="model-size">~1.8 GB</span>
                    <span class="model-desc">Most accurate</span>
                    <span id="vosk-large-status" class="model-install-status"></span>
                  </label>
                </div>
              </div>
              
              <!-- Download Progress Bar -->
              <div id="vosk-progress-container" class="vosk-progress-container" style="display: none;">
                <div class="vosk-progress-bar">
                  <div id="vosk-progress-fill" class="vosk-progress-fill" style="width: 0%"></div>
                </div>
                <span id="vosk-progress-text" class="vosk-progress-text">0%</span>
              </div>
              
              <!-- Action Buttons -->
              <div class="vosk-actions">
                <button id="download-vosk-btn" class="vosk-download-btn" title="Install Vosk Model">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                  </svg>
                  <span id="download-vosk-btn-text">Install Model</span>
                </button>
                <button id="delete-vosk-btn" class="vosk-delete-btn" title="Delete Vosk Model" style="display: none;">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                  </svg>
                  Delete Model
                </button>
              </div>
              
              <!-- Development mode notice -->
              <div id="vosk-dev-notice" class="vosk-dev-notice" style="display: none;">
                <span class="dev-badge">DEV</span>
                <span>Local models available - will extract from models/ folder</span>
              </div>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label" for="voice-language">Language</label>
              </div>
              <p class="field-description">Select the primary language for voice recognition.</p>
              <select id="voice-language" class="settings-select">
                <option value="en-US">English (US)</option>
                <option value="en-GB">English (UK)</option>
                <option value="es-ES">Spanish (Spain)</option>
                <option value="fr-FR">French</option>
                <option value="de-DE">German</option>
                <option value="it-IT">Italian</option>
                <option value="pt-BR">Portuguese (Brazil)</option>
                <option value="ja-JP">Japanese</option>
                <option value="ko-KR">Korean</option>
                <option value="zh-CN">Chinese (Simplified)</option>
              </select>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label">Auto-start Voice</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="voice-autostart">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <p class="field-description">Automatically start voice recognition when the app launches.</p>
            </div>
          </div>

          <!-- Screenshot Settings Section -->
          <div class="settings-section">
            <div class="section-header">
              <h3 class="section-title"><svg class="section-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg> Screenshot Settings</h3>
              <p class="section-description">Configure screenshot capture behavior.</p>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label" for="max-screenshots">Maximum Screenshots</label>
              </div>
              <p class="field-description">Maximum number of screenshots to store for analysis context.</p>
              <div class="range-input-group">
                <input type="range" id="max-screenshots" class="settings-range" min="1" max="10" value="3">
                <span id="max-screenshots-value" class="range-value">3</span>
              </div>
            </div>

            <div class="settings-field">
              <div class="field-header">
                <label class="field-label" for="capture-delay">Capture Delay (ms)</label>
              </div>
              <p class="field-description">Delay before capturing screenshot (allows window to hide first).</p>
              <div class="range-input-group">
                <input type="range" id="capture-delay" class="settings-range" min="100" max="1000" step="50" value="300">
                <span id="capture-delay-value" class="range-value">300ms</span>
              </div>
            </div>
          </div>
        </div>

        <div class="settings-footer">
          <button id="reset-settings" class="settings-btn-secondary">Reset to Defaults</button>
          <button id="save-all-settings" class="settings-btn-primary">Save & Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
